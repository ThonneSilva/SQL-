CREATE DATABASE Atv31_2;
USE Atv31_2;

CREATE TABLE Fornecedores (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(100),
    contato VARCHAR(50),
    endereco VARCHAR(255)
);

CREATE TABLE Canecas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(100),
    categoria VARCHAR(50),
    preco DECIMAL(10, 2),
    quantidade INT,
    fornecedor_id INT,
    FOREIGN KEY (fornecedor_id) REFERENCES Fornecedores(id)
);

CREATE TABLE Clientes (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(100),
    telefone VARCHAR(15),
    email VARCHAR(100)
);

CREATE TABLE Vendas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    cliente_id INT,
    data_venda TIMESTAMP,
    total DECIMAL(10, 2),
    FOREIGN KEY (cliente_id) REFERENCES Clientes(id)
);

CREATE TABLE ItensVenda (
    id INT PRIMARY KEY AUTO_INCREMENT,
    venda_id INT,
    caneca_id INT,
    quantidade INT,
    subtotal DECIMAL(10, 2),
    FOREIGN KEY (venda_id) REFERENCES Vendas(id),
    FOREIGN KEY (caneca_id) REFERENCES Canecas(id)
);

CREATE TABLE Estoque (
    id INT PRIMARY KEY AUTO_INCREMENT,
    caneca_id INT,
    quantidade INT,
    tipo_movimentacao ENUM('entrada', 'saida'),
    data_movimentacao TIMESTAMP,
    FOREIGN KEY (caneca_id) REFERENCES Canecas(id)
);

INSERT INTO Fornecedores 
(nome, contato, endereco) 
VALUES
('Fornecedor A', '1234-5678', 'Rua A, 123'),
('Fornecedor B', '2345-6789', 'Rua B, 234'),
('Fornecedor C', '3456-7890', 'Rua C, 345'),
('Fornecedor D', '4567-8901', 'Rua D, 456'),
('Fornecedor E', '5678-9012', 'Rua E, 567'),
('Fornecedor F', '6789-0123', 'Rua F, 678'),
('Fornecedor G', '7890-1234', 'Rua G, 789'),
('Fornecedor H', '8901-2345', 'Rua H, 890'),
('Fornecedor I', '9012-3456', 'Rua I, 901'),
('Fornecedor J', '0123-4567', 'Rua J, 012'),
('Fornecedor K', '1234-5679', 'Rua K, 123'),
('Fornecedor L', '2345-6780', 'Rua L, 234'),
('Fornecedor M', '3456-7891', 'Rua M, 345'),
('Fornecedor N', '4567-8902', 'Rua N, 456'),
('Fornecedor O', '5678-9013', 'Rua O, 567'),
('Fornecedor P', '6789-0124', 'Rua P, 678'),
('Fornecedor Q', '7890-1235', 'Rua Q, 789'),
('Fornecedor R', '8901-2346', 'Rua R, 890'),
('Fornecedor S', '9012-3457', 'Rua S, 901'),
('Fornecedor T', '0123-4568', 'Rua T, 012'),
('Fornecedor U', '1234-5680', 'Rua U, 123'),
('Fornecedor V', '2345-6781', 'Rua V, 234'),
('Fornecedor W', '3456-7892', 'Rua W, 345'),
('Fornecedor X', '4567-8903', 'Rua X, 456'),
('Fornecedor Y', '5678-9014', 'Rua Y, 567'),
('Fornecedor Z', '6789-0125', 'Rua Z, 678'),
('Fornecedor AA', '7890-1236', 'Rua AA, 789'),
('Fornecedor AB', '8901-2347', 'Rua AB, 890'),
('Fornecedor AC', '9012-3458', 'Rua AC, 901'),
('Fornecedor AD', '0123-4569', 'Rua AD, 012'),
('Fornecedor AE', '1234-5681', 'Rua AE, 123'),
('Fornecedor AF', '2345-6782', 'Rua AF, 234'),
('Fornecedor AG', '3456-7893', 'Rua AG, 345'),
('Fornecedor AH', '4567-8904', 'Rua AH, 456'),
('Fornecedor AI', '5678-9015', 'Rua AI, 567'),
('Fornecedor AJ', '6789-0126', 'Rua AJ, 678'),
('Fornecedor AK', '7890-1237', 'Rua AK, 789'),
('Fornecedor AL', '8901-2348', 'Rua AL, 890'),
('Fornecedor AM', '9012-3459', 'Rua AM, 901'),
('Fornecedor AN', '0123-4570', 'Rua AN, 012'),
('Fornecedor AO', '1234-5682', 'Rua AO, 123'),
('Fornecedor AP', '2345-6783', 'Rua AP, 234'),
('Fornecedor AQ', '3456-7894', 'Rua AQ, 345'),
('Fornecedor AR', '4567-8905', 'Rua AR, 456'),
('Fornecedor AS', '5678-9016', 'Rua AS, 567'),
('Fornecedor AT', '6789-0127', 'Rua AT, 678'),
('Fornecedor AU', '7890-1238', 'Rua AU, 789'),
('Fornecedor AV', '8901-2349', 'Rua AV, 890'),
('Fornecedor AW', '9012-3460', 'Rua AW, 901'),
('Fornecedor AX', '0123-4571', 'Rua AX, 012'),
('Fornecedor AY', '1234-5683', 'Rua AY, 123'),
('Fornecedor AZ', '2345-6784', 'Rua AZ, 234');


INSERT INTO Canecas 
(nome, categoria, preco, quantidade, fornecedor_id) 
VALUES
('Caneca A', 'Cerâmica', 15.99, 100, 1),
('Caneca B', 'Plástico', 10.99, 50, 2),
('Caneca C', 'Vidro', 20.50, 75, 3),
('Caneca D', 'Cerâmica', 12.50, 30, 4),
('Caneca E', 'Plástico', 9.99, 20, 5),
('Caneca F', 'Vidro', 25.00, 40, 6),
('Caneca G', 'Cerâmica', 18.00, 80, 7),
('Caneca H', 'Plástico', 14.99, 60, 8),
('Caneca I', 'Vidro', 22.00, 45, 9),
('Caneca J', 'Cerâmica', 16.50, 55, 10),
('Caneca K', 'Plástico', 11.99, 35, 11),
('Caneca L', 'Vidro', 23.50, 25, 12),
('Caneca M', 'Cerâmica', 17.00, 90, 13),
('Caneca N', 'Plástico', 13.50, 70, 14),
('Caneca O', 'Vidro', 21.00, 30, 15),
('Caneca P', 'Cerâmica', 19.99, 60, 16),
('Caneca Q', 'Plástico', 15.50, 40, 17),
('Caneca R', 'Vidro', 24.00, 50, 18),
('Caneca S', 'Cerâmica', 20.00, 20, 19),
('Caneca T', 'Plástico', 12.00, 75, 20),
('Caneca U', 'Vidro', 26.00, 10, 21),
('Caneca V', 'Cerâmica', 15.00, 55, 22),
('Caneca W', 'Plástico', 14.50, 85, 23),
('Caneca X', 'Vidro', 27.00, 65, 24),
('Caneca Y', 'Cerâmica', 22.00, 45, 25),
('Caneca Z', 'Plástico', 11.50, 95, 26),
('Caneca AA', 'Vidro', 28.00, 30, 27),
('Caneca AB', 'Cerâmica', 15.75, 50, 28),
('Caneca AC', 'Plástico', 13.25, 25, 29),
('Caneca AD', 'Vidro', 29.00, 35, 30),
('Caneca AE', 'Cerâmica', 16.25, 20, 31),
('Caneca AF', 'Plástico', 12.75, 15, 32),
('Caneca AG', 'Vidro', 30.00, 40, 33),
('Caneca AH', 'Cerâmica', 19.25, 80, 34),
('Caneca AI', 'Plástico', 14.25, 60, 35),
('Caneca AJ', 'Vidro', 31.00, 70, 36),
('Caneca AK', 'Cerâmica', 18.75, 90, 37),
('Caneca AL', 'Plástico', 10.25, 55, 38),
('Caneca AM', 'Vidro', 32.00, 45, 39),
('Caneca AN', 'Cerâmica', 17.50, 50, 40),
('Caneca AO', 'Plástico', 13.75, 35, 41),
('Caneca AP', 'Vidro', 33.00, 20, 42),
('Caneca AQ', 'Cerâmica', 21.50, 60, 43),
('Caneca AR', 'Plástico', 15.25, 40, 44),
('Caneca AS', 'Vidro', 34.00, 30, 45),
('Caneca AT', 'Cerâmica', 21.50, 60, 46),
('Caneca AU', 'Plástico', 15.25, 40, 47),
('Caneca AV', 'Vidro', 34.00, 30, 48),
('Caneca AW', 'Cerâmica', 21.50, 60, 49),
('Caneca AX', 'Plástico', 15.25, 40, 50);

INSERT INTO Clientes 
(nome, telefone, email) 
VALUES
('Cliente A', '9999-0001', 'clienteA@email.com'),
('Cliente B', '9999-0002', 'clienteB@email.com'),
('Cliente C', '9999-0003', 'clienteC@email.com'),
('Cliente D', '9999-0004', 'clienteD@email.com'),
('Cliente E', '9999-0005', 'clienteE@email.com'),
('Cliente F', '9999-0006', 'clienteF@email.com'),
('Cliente G', '9999-0007', 'clienteG@email.com'),
('Cliente H', '9999-0008', 'clienteH@email.com'),
('Cliente I', '9999-0009', 'clienteI@email.com'),
('Cliente J', '9999-0010', 'clienteJ@email.com'),
('Cliente K', '9999-0011', 'clienteK@email.com'),
('Cliente L', '9999-0012', 'clienteL@email.com'),
('Cliente M', '9999-0013', 'clienteM@email.com'),
('Cliente N', '9999-0014', 'clienteN@email.com'),
('Cliente O', '9999-0015', 'clienteO@email.com'),
('Cliente P', '9999-0016', 'clienteP@email.com'),
('Cliente Q', '9999-0017', 'clienteQ@email.com'),
('Cliente R', '9999-0018', 'clienteR@email.com'),
('Cliente S', '9999-0019', 'clienteS@email.com'),
('Cliente T', '9999-0020', 'clienteT@email.com'),
('Cliente U', '9999-0021', 'clienteU@email.com'),
('Cliente V', '9999-0022', 'clienteV@email.com'),
('Cliente W', '9999-0023', 'clienteW@email.com'),
('Cliente X', '9999-0024', 'clienteX@email.com'),
('Cliente Y', '9999-0025', 'clienteY@email.com'),
('Cliente Z', '9999-0026', 'clienteZ@email.com'),
('Cliente AA', '9999-0027', 'clienteAA@email.com'),
('Cliente AB', '9999-0028', 'clienteAB@email.com'),
('Cliente AC', '9999-0029', 'clienteAC@email.com'),
('Cliente AD', '9999-0030', 'clienteAD@email.com'),
('Cliente AE', '9999-0031', 'clienteAE@email.com'),
('Cliente AF', '9999-0032', 'clienteAF@email.com'),
('Cliente AG', '9999-0033', 'clienteAG@email.com'),
('Cliente AH', '9999-0034', 'clienteAH@email.com'),
('Cliente AI', '9999-0035', 'clienteAI@email.com'),
('Cliente AJ', '9999-0036', 'clienteAJ@email.com'),
('Cliente AK', '9999-0037', 'clienteAK@email.com'),
('Cliente AL', '9999-0038', 'clienteAL@email.com'),
('Cliente AM', '9999-0039', 'clienteAM@email.com'),
('Cliente AN', '9999-0040', 'clienteAN@email.com'),
('Cliente AO', '9999-0041', 'clienteAO@email.com'),
('Cliente AP', '9999-0042', 'clienteAP@email.com'),
('Cliente AQ', '9999-0043', 'clienteAQ@email.com'),
('Cliente AR', '9999-0044', 'clienteAR@email.com'),
('Cliente AS', '9999-0045', 'clienteAS@email.com'),
('Cliente AT', '9999-0046', 'clienteAT@email.com'),
('Cliente AU', '9999-0047', 'clienteAU@email.com'),
('Cliente AV', '9999-0048', 'clienteAV@email.com'),
('Cliente AW', '9999-0049', 'clienteAW@email.com'),
('Cliente AX', '9999-0050', 'clienteAX@email.com');

INSERT INTO Vendas 
(cliente_id, data_venda, total) 
VALUES
(1, NOW(), 150.00),
(2, NOW(), 75.50),
(3, NOW(), 90.00),
(4, NOW(), 120.00),
(5, NOW(), 110.00),
(6, NOW(), 100.00),
(7, NOW(), 85.00),
(8, NOW(), 130.00),
(9, NOW(), 95.00),
(10, NOW(), 115.00),
(11, NOW(), 145.00),
(12, NOW(), 80.00),
(13, NOW(), 160.00),
(14, NOW(), 140.00),
(15, NOW(), 95.00),
(16, NOW(), 135.00),
(17, NOW(), 90.00),
(18, NOW(), 110.00),
(19, NOW(), 100.00),
(20, NOW(), 75.00),
(21, NOW(), 80.00),
(22, NOW(), 150.00),
(23, NOW(), 165.00),
(24, NOW(), 55.00),
(25, NOW(), 125.00),
(26, NOW(), 135.00),
(27, NOW(), 70.00),
(28, NOW(), 115.00),
(29, NOW(), 145.00),
(30, NOW(), 60.00),
(31, NOW(), 95.00),
(32, NOW(), 140.00),
(33, NOW(), 155.00),
(34, NOW(), 130.00),
(35, NOW(), 120.00),
(36, NOW(), 110.00),
(37, NOW(), 100.00),
(38, NOW(), 80.00),
(39, NOW(), 90.00),
(40, NOW(), 150.00),
(41, NOW(), 165.00),
(42, NOW(), 55.00),
(43, NOW(), 125.00),
(44, NOW(), 135.00),
(45, NOW(), 70.00),
(46, NOW(), 115.00),
(47, NOW(), 145.00),
(48, NOW(), 60.00),
(49, NOW(), 95.00),
(50, NOW(), 140.00);

INSERT INTO ItensVenda 
(venda_id, caneca_id, quantidade, subtotal) 
VALUES
(1, 1, 5, 79.95),
(1, 2, 3, 32.97),
(2, 3, 2, 41.00),
(2, 4, 1, 12.50),
(3, 5, 4, 39.96),
(3, 6, 2, 50.00),
(4, 7, 5, 90.00),
(4, 8, 2, 29.98),
(5, 9, 3, 64.50),
(5, 10, 1, 16.50),
(6, 11, 2, 25.00),
(6, 12, 1, 10.99),
(7, 13, 4, 55.00),
(7, 14, 1, 18.75),
(8, 15, 3, 45.00),
(8, 16, 2, 25.50),
(9, 17, 5, 100.00),
(9, 18, 2, 38.00),
(10, 19, 1, 22.00),
(10, 20, 3, 40.50),
(11, 21, 4, 54.00),
(11, 22, 2, 20.00),
(12, 23, 5, 77.50),
(12, 24, 1, 10.00),
(13, 25, 3, 41.97),
(13, 26, 2, 31.00),
(14, 27, 4, 65.00),
(14, 28, 1, 15.75),
(15, 29, 5, 78.00),
(15, 30, 2, 25.50),
(16, 31, 1, 20.00),
(16, 32, 3, 36.00),
(17, 33, 4, 80.00),
(17, 34, 1, 20.00),
(18, 35, 5, 80.00),
(18, 36, 2, 25.00),
(19, 37, 3, 45.00),
(19, 38, 1, 10.00),
(20, 39, 4, 80.00),
(20, 40, 1, 20.00),
(21, 41, 5, 65.00),
(21, 42, 2, 30.00),
(22, 43, 3, 45.00),
(22, 44, 1, 10.00),
(23, 45, 4, 80.00),
(23, 46, 1, 20.00),
(24, 47, 5, 65.00),
(24, 48, 2, 30.00),
(25, 49, 3, 45.00),
(25, 50, 1, 10.00),
(26, 1, 2, 31.50),
(26, 2, 5, 64.95),
(27, 3, 1, 20.50),
(27, 4, 3, 37.50),
(28, 5, 4, 39.96),
(28, 6, 2, 50.00),
(29, 7, 3, 54.00),
(29, 8, 1, 18.75),
(30, 9, 5, 85.00),
(30, 10, 2, 20.50),
(31, 11, 1, 25.00),
(31, 12, 3, 32.97),
(32, 13, 2, 29.50),
(32, 14, 4, 75.00),
(33, 15, 3, 45.00),
(33, 16, 1, 14.99),
(34, 17, 2, 30.00),
(34, 18, 5, 110.00),
(35, 19, 1, 22.00),
(35, 20, 2, 25.00),
(36, 21, 4, 70.00),
(36, 22, 1, 10.50),
(37, 23, 5, 80.00),
(37, 24, 3, 39.00),
(38, 25, 2, 32.00),
(38, 26, 1, 15.00),
(39, 27, 4, 60.00),
(39, 28, 1, 12.50),
(40, 29, 5, 75.00),
(40, 30, 2, 25.00),
(41, 31, 1, 20.00),
(41, 32, 3, 54.00),
(42, 33, 4, 85.00),
(42, 34, 1, 15.00),
(43, 35, 5, 90.00),
(43, 36, 2, 40.00),
(44, 37, 3, 50.00),
(44, 38, 1, 10.00),
(45, 39, 4, 60.00),
(45, 40, 1, 20.00),
(46, 41, 5, 75.00),
(46, 42, 2, 25.00),
(47, 43, 3, 45.00),
(47, 44, 1, 10.00),
(48, 45, 4, 80.00),
(48, 46, 1, 15.00),
(49, 47, 5, 90.00),
(49, 48, 2, 20.00),
(50, 49, 3, 60.00),
(50, 50, 1, 10.00);


INSERT INTO Estoque (caneca_id, quantidade, tipo_movimentacao, data_movimentacao) VALUES 
(1, 10, 'entrada', NOW()), 
(2, 5, 'entrada', NOW()), 
(3, 7, 'entrada', NOW()), 
(1, 2, 'saida', NOW()), 
(2, 1, 'saida', NOW()), 
(3, 3, 'saida', NOW()), 
(4, 15, 'entrada', NOW()), 
(5, 20, 'entrada', NOW()), 
(6, 5, 'saida', NOW()), 
(7, 3, 'entrada', NOW()), 
(8, 10, 'entrada', NOW()), 
(9, 4, 'saida', NOW()), 
(10, 1, 'saida', NOW()), 
(1, 12, 'entrada', NOW()), 
(2, 8, 'saida', NOW()), 
(3, 5, 'entrada', NOW()), 
(4, 10, 'saida', NOW()), 
(5, 6, 'entrada', NOW()), 
(6, 1, 'saida', NOW()), 
(7, 10, 'entrada', NOW()), 
(8, 3, 'saida', NOW()), 
(9, 15, 'entrada', NOW()), 
(10, 7, 'saida', NOW()), 
(1, 4, 'entrada', NOW()), 
(2, 9, 'saida', NOW()), 
(3, 8, 'entrada', NOW()), 
(4, 5, 'saida', NOW()), 
(5, 12, 'entrada', NOW()), 
(6, 3, 'saida', NOW()), 
(7, 6, 'entrada', NOW()), 
(8, 8, 'saida', NOW()), 
(9, 5, 'entrada', NOW()), 
(10, 10, 'saida', NOW()), 
(1, 7, 'entrada', NOW()), 
(2, 4, 'saida', NOW()), 
(3, 3, 'entrada', NOW()), 
(4, 2, 'saida', NOW()), 
(5, 8, 'entrada', NOW()), 
(6, 7, 'saida', NOW()), 
(7, 11, 'entrada', NOW()), 
(8, 9, 'saida', NOW()), 
(9, 6, 'entrada', NOW()), 
(10, 12, 'saida', NOW()), 
(1, 14, 'entrada', NOW()), 
(2, 16, 'saida', NOW()), 
(3, 10, 'entrada', NOW()), 
(4, 13, 'saida', NOW()), 
(5, 11, 'entrada', NOW()), 
(6, 15, 'saida', NOW()), 
(7, 2, 'entrada', NOW()), 
(8, 1, 'saida', NOW()), 
(9, 5, 'entrada', NOW()), 
(10, 3, 'saida', NOW());

SELECT v.data_venda, SUM(v.total) AS total_vendas
FROM Vendas v
WHERE v.data_venda BETWEEN '2023-01-01' AND '2023-12-31'
GROUP BY v.data_venda
ORDER BY v.data_venda;


SELECT ca.nome, SUM(iv.quantidade) AS total_vendido
FROM ItensVenda iv
JOIN Canecas ca ON iv.caneca_id = ca.id
GROUP BY ca.nome
ORDER BY total_vendido DESC;


SELECT ca.nome, 
       (SUM(CASE WHEN e.tipo_movimentacao = 'entrada' THEN e.quantidade ELSE 0 END) -
        SUM(CASE WHEN e.tipo_movimentacao = 'saida' THEN e.quantidade ELSE 0 END)) AS quantidade_atual
FROM Estoque e
JOIN Canecas ca ON e.caneca_id = ca.id
GROUP BY ca.nome;


SELECT e.data_movimentacao, ca.nome, e.quantidade, e.tipo_movimentacao
FROM Estoque e
JOIN Canecas ca ON e.caneca_id = ca.id
ORDER BY e.data_movimentacao DESC;